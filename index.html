<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Iceland Trip - V92 Stable Sync</title>
    
    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f4c75">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Iceland Trip">
    
    <!-- Libraries -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Montserrat', 'Noto Sans TC', system-ui, sans-serif; background-color: #F8FAFC; color: #334155; margin: 0; padding: 0; }
        [v-cloak] { display: none !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        #map-full { height: calc(100vh - 240px); width: 100%; border-radius: 1rem; z-index: 1; }
        .header-refined-bg {
            background-color: #F8FAFC; background-image: linear-gradient(to bottom, #ffffff 0%, #F1F5F9 100%);
            border-bottom: 1px solid #e2e8f0; box-shadow: 0 10px 30px -10px rgba(15, 76, 117, 0.1); z-index: 50; position: relative;
        }
        .header-glow { position: absolute; top: -20%; right: -10%; width: 70%; height: 100%; background: radial-gradient(circle, rgba(50, 130, 184, 0.08) 0%, transparent 70%); pointer-events: none; z-index: 0; }
        .fade-mask-left { position: absolute; left: 0; top: 0; bottom: 0; width: 24px; background: linear-gradient(to right, #F8FAFC 20%, transparent); z-index: 20; pointer-events: none; }
        .fade-mask-right { position: absolute; right: 0; top: 0; bottom: 0; width: 24px; background: linear-gradient(to left, #F8FAFC 20%, transparent); z-index: 20; pointer-events: none; }
        .bg-aurora { background: linear-gradient(135deg, #0f4c75 0%, #3282b8 50%, #00b894 100%); }
        .bg-card-top { background-color: #112442; }
        .bg-card-bottom { background-color: #0B1D35; }
        .modal-input { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.8rem; padding: 0.8rem; width: 100%; outline: none; font-weight: 600; transition: all 0.2s; }
        .modal-input:focus { border-color: #3282b8; background-color: #fff; }
        .ratio-16-9 { width: 100%; aspect-ratio: 16 / 9; object-fit: cover; background-color: #e2e8f0; }
        .tab-active { color: #0f4c75; }
        .tab-inactive { color: #94a3b8; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .dashed-line-anim { width: 100%; height: 2px; background-image: linear-gradient(to right, rgba(255,255,255,0.3) 50%, transparent 50%); background-size: 8px 2px; animation: dashMove 1s linear infinite; }
        @keyframes dashMove { 0% { background-position: 0 0; } 100% { background-position: 16px 0; } }
        .mask-top { --r: 12px; -webkit-mask: radial-gradient(var(--r) at bottom left, #0000 98%, #000 101%) bottom left, radial-gradient(var(--r) at bottom right, #0000 98%, #000 101%) bottom right, linear-gradient(#000 0 0) top; mask: radial-gradient(var(--r) at bottom left, #0000 98%, #000 101%) bottom left, radial-gradient(var(--r) at bottom right, #0000 98%, #000 101%) bottom right, linear-gradient(#000 0 0) top; -webkit-mask-size: 51% 100%; -webkit-mask-repeat: no-repeat; mask-size: 51% 100%; mask-repeat: no-repeat; }
        .mask-bottom { --r: 12px; -webkit-mask: radial-gradient(var(--r) at top left, #0000 98%, #000 101%) top left, radial-gradient(var(--r) at top right, #0000 98%, #000 101%) top right, linear-gradient(#000 0 0) bottom; mask: radial-gradient(var(--r) at top left, #0000 98%, #000 101%) top left, radial-gradient(var(--r) at top right, #0000 98%, #000 101%) top right, linear-gradient(#000 0 0) bottom; -webkit-mask-size: 51% 100%; -webkit-mask-repeat: no-repeat; mask-size: 51% 100%; mask-repeat: no-repeat; }
        .ticket-filter-shadow { filter: drop-shadow(0 10px 15px rgba(11, 29, 53, 0.25)); }
        .seam-layer { position: relative; height: 0; z-index: 50; }
        .seam-badge { display: inline-flex; align-items: center; gap: 0.5rem; background-color: #112442; padding: 0.375rem 1.25rem; border: 1px solid rgba(50, 130, 184, 0.3); border-radius: 9999px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); position: relative; z-index: 50; }
        .modal-overlay { background-color: rgba(15, 23, 42, 0.6); }
        .expense-item { display: flex; align-items: center; padding: 12px; background: white; border-radius: 12px; margin-bottom: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; }
        .info-card { background: white; border-radius: 1rem; padding: 1rem; margin-bottom: 1rem; border: 1px solid #e2e8f0; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .kp-badge { display: inline-flex; width: 1.5rem; height: 1.5rem; align-items: center; justify-content: center; border-radius: 9999px; font-weight: bold; font-size: 0.7rem; color: white; margin-right: 0.5rem; }
    </style>
</head>
<body class="bg-[#F8FAFC]">

<div id="app" class="w-full max-w-md mx-auto min-h-screen flex flex-col relative pb-24" v-cloak>

    <!-- Guest/Sync Mode Banner -->
    <div v-if="syncStatus.isGuest" class="bg-orange-500 text-white text-[10px] font-bold text-center py-1 sticky top-0 z-[60] shadow-md">
        <i class="fa-solid fa-eye"></i> é›²ç«¯åŒæ­¥ (è¨ªå®¢/å”¯è®€æ¨¡å¼)
    </div>
    <div v-else-if="gistConfig.id" class="bg-[#3282b8] text-white text-[10px] font-bold text-center py-1 sticky top-0 z-[60] shadow-md flex justify-center items-center gap-2 cursor-pointer" @click="syncModal.open=true">
        <i class="fa-solid fa-cloud"></i> é›²ç«¯åŒæ­¥å·²å•Ÿç”¨ <span v-if="syncStatus.unsaved" class="bg-red-400 px-1.5 rounded-full text-[8px]">æœªä¸Šå‚³</span>
    </div>

    <!-- 1. HEADER -->
    <div class="sticky z-40 header-refined-bg pt-6 px-0 relative pb-0 overflow-hidden" :class="(syncStatus.isGuest || gistConfig.id) ? 'top-6' : 'top-0'">
        <div class="header-glow"></div>
        <div class="flex justify-between items-center mb-2 px-6 relative z-10">
            <!-- V91: Sync Button replaces Share Button -->
            <button @click="syncModal.open=true" class="w-10 h-10 rounded-2xl bg-white/80 flex items-center justify-center hover:bg-white transition-all active:scale-95 shadow-sm border border-slate-100" :class="gistConfig.id ? 'text-green-500' : 'text-[#3282b8]'">
                <i class="fa-solid" :class="gistConfig.id ? 'fa-cloud-arrow-up' : 'fa-cloud-gear'"></i>
            </button>
            
            <div class="flex flex-col items-center">
                <div class="text-[10px] font-bold tracking-[0.2em] text-slate-400 uppercase mb-1 drop-shadow-sm">Iceland Trip</div>
                <div class="bg-gradient-to-r from-[#0f4c75] to-[#3282b8] px-4 py-1.5 rounded-full shadow-lg shadow-blue-900/10">
                    <h1 class="text-center font-bold text-xs text-white tracking-wider flex items-center gap-2"><i class="fa-regular fa-snowflake fa-spin-pulse" style="--fa-animation-duration: 3s;"></i> 2026-03 å†°å³¶æ¥µå…‰è‡ªé§•éŠ <i class="fa-regular fa-snowflake fa-spin-pulse" style="--fa-animation-duration: 4s;"></i></h1>
                </div>
            </div>
            <div class="w-10"></div>
        </div>
        <!-- Date Selector -->
        <div v-show="currentTab === 'itinerary' || currentTab === 'map'" class="relative z-10 animate-slide-up">
            <div class="fade-mask-left"></div><div class="fade-mask-right"></div>
            <div class="flex overflow-x-auto gap-3 pl-6 pr-6 pt-2 pb-0 no-scrollbar snap-x cursor-grab active:cursor-grabbing items-center relative z-10">
                <button v-for="d in totalDays" :key="d" @click="currentDay = d" class="flex flex-col items-center justify-center transition-all duration-200 flex-shrink-0 w-[68px] py-3 rounded-2xl border snap-center group relative mb-4 bg-white shadow-sm" :class="currentDay === d ? 'bg-[#0f4c75] !text-white !border-[#0f4c75] shadow-xl shadow-blue-900/40 ring-1 ring-[#0f4c75]/20' : 'text-slate-400 border-slate-100 hover:bg-white hover:border-slate-200 hover:shadow-md'">
                    <span class="text-[9px] font-bold uppercase tracking-wider opacity-70">Day {{ d }}</span>
                    <div class="w-1 h-1 rounded-full my-1.5 transition-all" :class="currentDay === d ? 'bg-[#00b894] w-4' : 'bg-slate-300'"></div>
                    <div class="flex flex-col items-center leading-none gap-0.5"><span class="text-[13px] font-bold font-mono">{{ getDateString(d).date }}</span><span class="text-[10px] font-bold opacity-80 font-mono tracking-wider">{{ getDateString(d).day }}</span></div>
                </button>
                <button v-if="!syncStatus.isGuest" @click="addDay" class="flex-shrink-0 w-12 h-12 rounded-2xl border-2 border-dashed border-slate-300 text-slate-400 flex items-center justify-center hover:border-[#3282b8] hover:text-[#3282b8] hover:bg-white transition snap-center mb-4"><i class="fa-solid fa-plus text-lg"></i></button>
                <button v-if="!syncStatus.isGuest" @click="deleteLastDay" class="flex-shrink-0 w-12 h-12 rounded-2xl border-2 border-dashed border-red-200 text-red-300 flex items-center justify-center hover:border-red-500 hover:text-red-500 hover:bg-red-50 transition snap-center mr-6 mb-4"><i class="fa-solid fa-trash-can text-lg"></i></button>
            </div>
        </div>
        <div v-show="currentTab !== 'itinerary' && currentTab !== 'map'" class="h-2"></div>
    </div>

    <!-- === TAB 1: FLIGHT === -->
    <div v-show="currentTab === 'flight'" class="px-6 flex-grow overflow-y-auto pt-4 pb-24">
        <div class="flex justify-between items-center mb-6"><h3 class="font-bold text-slate-700 text-sm flex items-center"><i class="fa-solid fa-ticket text-blue-400 mr-2"></i>èˆªç­è³‡æ–™</h3></div>
        <div v-for="(group, gIdx) in groupedFlights" :key="gIdx" class="mb-8 relative ticket-filter-shadow">
            <div class="flex flex-col relative">
                <div class="bg-card-top text-white p-6 pb-8 relative rounded-t-[1.5rem] mask-top z-10">
                    <div class="flex items-center justify-between mb-4"><span class="bg-[#3282b8] text-white text-[12px] font-bold px-4 py-1 rounded-full shadow-sm">{{ group.type }}</span><span class="text-[11px] font-bold text-slate-300 font-mono flex items-center gap-2"><i class="fa-regular fa-calendar"></i> {{ group.date }}</span></div>
                    <div class="h-px w-full bg-white/10 mb-5"></div>
                    <div class="flex justify-center mb-5"><div class="text-[13px] text-[#3282b8] font-bold bg-white/5 px-5 py-1.5 rounded-lg border border-[#3282b8]/20 tracking-wider shadow-inner flex items-center gap-3"><span class="text-slate-400 text-[10px] font-medium tracking-wide">FINNAIR</span><div class="w-[1px] h-3 bg-white/20"></div><span>{{ group.f1.code }}</span></div></div>
                    <div class="flex items-center justify-between px-1">
                        <div class="text-center w-24"><div class="text-[10px] text-slate-400 font-bold uppercase mb-1">{{ group.f1.depCity }}</div><div class="text-[42px] font-black tracking-tighter text-white leading-none mb-1">{{ group.f1.depCode }}</div><div class="text-[13px] font-bold font-mono text-slate-300">{{ group.f1.depTime }}</div></div>
                        <div class="flex-grow mx-2 flex flex-col items-center justify-center gap-1"><div class="w-full flex items-center gap-2"><div class="dashed-line-anim flex-grow"></div><i class="fa-solid fa-plane text-white text-[14px]"></i><div class="dashed-line-anim flex-grow"></div></div><span class="text-[10px] text-slate-400 font-mono mt-1">{{ group.f1.duration }}</span></div>
                        <div class="text-center w-24"><div class="text-[10px] text-slate-400 font-bold uppercase mb-1">{{ group.f1.arrCity }}</div><div class="text-[42px] font-black tracking-tighter text-white leading-none mb-1">{{ group.f1.arrCode }}</div><div class="text-[13px] font-bold font-mono text-slate-300">{{ group.f1.arrTime }}</div></div>
                    </div>
                </div>
                <div class="seam-layer"><div class="absolute top-0 left-0 right-0 flex justify-center items-center" style="transform: translateY(-50%);"><div class="absolute left-[14px] right-[14px] border-t-2 border-dashed border-[#3282b8]/40 h-0 z-30"></div><div class="seam-badge z-40"><i class="fa-solid fa-clock text-[#00b894] text-[10px]"></i><span class="text-[11px] font-bold text-[#00b894] tracking-wide">è½‰æ©Ÿ {{ group.layover }}</span></div></div></div>
                <div class="bg-card-bottom text-white p-6 pt-10 pb-8 rounded-b-[1.5rem] mask-bottom z-10 -mt-[1px]">
                     <div class="flex justify-center mb-5"><div class="text-[13px] text-[#3282b8] font-bold bg-white/5 px-5 py-1.5 rounded-lg border border-[#3282b8]/20 tracking-wider shadow-inner flex items-center gap-3"><span class="text-slate-400 text-[10px] font-medium tracking-wide">FINNAIR</span><div class="w-[1px] h-3 bg-white/20"></div><span>{{ group.f2.code }}</span></div></div>
                    <div class="flex items-center justify-between px-1">
                        <div class="text-center w-24"><div class="text-[10px] text-slate-400 font-bold uppercase mb-1">{{ group.f2.depCity }}</div><div class="text-[42px] font-black tracking-tighter text-white leading-none mb-1">{{ group.f2.depCode }}</div><div class="text-[13px] font-bold font-mono text-slate-300">{{ group.f2.depTime }}</div></div>
                         <div class="flex-grow mx-2 flex flex-col items-center justify-center gap-1"><div class="w-full flex items-center gap-2"><div class="dashed-line-anim flex-grow"></div><i class="fa-solid fa-plane text-white text-[14px]"></i><div class="dashed-line-anim flex-grow"></div></div><span class="text-[10px] text-slate-400 font-mono mt-1">{{ group.f2.duration }}</span></div>
                        <div class="text-center w-24"><div class="text-[10px] text-slate-400 font-bold uppercase mb-1">{{ group.f2.arrCity }}</div><div class="text-[42px] font-black tracking-tighter text-white leading-none mb-1">{{ group.f2.arrCode }}</div><div class="text-[13px] font-bold font-mono text-slate-300">{{ group.f2.arrTime }}</div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- === TAB 2: ITINERARY === -->
    <div v-show="currentTab === 'itinerary'" class="flex-grow flex flex-col">
        <div class="px-6 py-4">
             <div class="flex items-center justify-between gap-2">
                <div class="flex items-center gap-3 flex-grow"><div class="w-1.5 h-8 rounded-full bg-aurora"></div><input type="text" v-model="safeCurrentItinerary.region" class="font-extrabold text-2xl text-slate-800 bg-transparent border-none outline-none w-full placeholder:text-slate-300 min-w-0" placeholder="è¼¸å…¥åœ°å€..." :disabled="syncStatus.isGuest"></div>
                <div class="flex items-center gap-2 bg-white p-1.5 rounded-xl border border-slate-100 shadow-sm flex-shrink-0">
                    <input type="text" v-model="safeCurrentItinerary.temp" @blur="formatTemp" placeholder="Temp" class="w-12 text-center text-xs font-bold text-slate-600 outline-none bg-transparent placeholder:text-slate-300" :disabled="syncStatus.isGuest"><div class="w-[1px] h-4 bg-slate-200"></div>
                    <div class="relative">
                        <button @click="syncStatus.isGuest ? null : weatherMenuOpen = !weatherMenuOpen" class="flex items-center gap-1.5 px-2 py-1 rounded-lg hover:bg-slate-50 text-slate-600 transition text-xs font-bold"><i class="fa-solid" :class="[getCurrentWeather.icon, getCurrentWeather.color]"></i><span>{{ getCurrentWeather.text }}</span></button>
                        <div v-if="weatherMenuOpen" class="absolute top-10 right-0 bg-white shadow-xl rounded-xl p-2 z-50 border w-28 flex flex-col gap-1">
                            <button v-for="(w, key) in weatherTypes" :key="key" @click="setWeather(key)" class="flex items-center gap-2 px-2 py-2 hover:bg-slate-50 rounded text-xs text-left w-full"><i class="fa-solid w-4 text-center" :class="[w.icon, w.color]"></i> {{ w.text }}</button>
                        </div><div v-if="weatherMenuOpen" @click="weatherMenuOpen = false" class="fixed inset-0 z-40"></div>
                    </div>
                </div>
             </div>
        </div>
        <div class="flex-grow overflow-y-auto px-6 pb-24">
            <div class="relative min-h-[300px]">
                <div class="absolute left-[15px] top-4 bottom-0 w-[2px] bg-gradient-to-b from-slate-200 to-slate-100"></div>
                <div v-for="(item, idx) in currentActivities" :key="item.id" class="relative pl-10 mb-8">
                    <div class="absolute left-[11px] top-[7px] w-[10px] h-[10px] rounded-full border-[2px] border-[#3282b8] bg-white z-10 shadow-sm"></div>
                    <div class="flex justify-between items-baseline mb-2 text-[#0f4c75] font-mono text-sm font-bold"><span>{{ item.time }} <span v-if="item.endTime" class="text-slate-400 text-xs">â†’ {{ item.endTime }}</span></span><span v-if="item.distance" class="bg-white px-2 py-0.5 rounded border border-slate-100 text-[10px] text-slate-400 shadow-sm"><i class="fa-solid fa-route mr-1"></i>{{ item.distance }}</span></div>
                    <div class="bg-white rounded-[1.5rem] shadow-[0_4px_20px_rgb(0,0,0,0.03)] border border-slate-100 overflow-hidden group hover:shadow-lg transition-shadow relative">
                        <div class="relative border-b border-slate-50">
                             <img :src="getCardImage(item)" class="ratio-16-9" loading="lazy" @error="handleImageError"><div class="absolute inset-0 bg-gradient-to-t from-[#0f4c75]/60 to-transparent opacity-80"></div>
                             <button v-if="!syncStatus.isGuest" @click="openEditModal(item)" class="absolute top-3 right-3 w-9 h-9 rounded-full bg-white/20 backdrop-blur-none text-white flex items-center justify-center shadow-lg border border-white/30 hover:scale-110 transition"><i class="fa-solid fa-pen text-xs"></i></button>
                        </div>
                        <div class="p-5 relative pb-14">
                            <h3 class="font-bold text-slate-800 text-lg leading-tight mb-2">{{ item.title }}</h3><p class="text-xs text-slate-500 line-clamp-2 mb-4 leading-relaxed font-medium">{{ item.desc }}</p>
                            <div class="flex flex-wrap gap-2 pr-16">
                                <span class="text-[10px] px-3 py-1 rounded-full font-bold shadow-sm" :class="getCategoryStyle(item.type).badge">{{ getCategoryStyle(item.type).label }}</span>
                                <span v-for="(c, i) in item.costs" :key="i" class="text-[10px] px-3 py-1 rounded-full bg-slate-50 text-slate-600 border border-slate-200 font-mono"><span class="font-bold text-slate-400 mr-1">{{ getCostLabel(c) }}:</span>{{ c.currency }} {{ formatMoney(c.amount) }}</span>
                            </div>
                            <!-- V84: Update Nav Link to use Location Name -->
                            <a v-if="item.lat || item.mapUrl || item.location" :href="item.mapUrl || 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.location || item.title || (item.lat + ',' + item.lng))" target="_blank" class="absolute bottom-4 right-4 text-[10px] bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full font-bold shadow-sm flex items-center gap-1.5 hover:bg-blue-100 transition cursor-pointer no-underline z-20"><i class="fa-solid fa-location-arrow text-[9px]"></i> å°èˆª</a>
                        </div>
                    </div>
                </div>
                <div v-if="currentActivities.length === 0" class="flex flex-col items-center justify-center py-10 opacity-40"><div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-3 text-slate-300 text-2xl"><i class="fa-solid fa-wind"></i></div><p class="text-xs text-slate-400 font-bold">æš«ç„¡è¡Œç¨‹</p></div>
            </div>
        </div>
        <button v-if="!syncStatus.isGuest" @click="openAddModal" class="fixed bottom-24 right-6 w-14 h-14 bg-aurora text-white rounded-[1.2rem] shadow-xl shadow-blue-500/30 flex items-center justify-center z-30 hover:scale-105 transition"><i class="fa-solid fa-plus text-xl"></i></button>
    </div>

    <!-- === TAB 3: MAP === -->
    <div v-show="currentTab === 'map'" class="px-6 flex-grow flex flex-col h-full pt-2">
        <div class="bg-white rounded-xl p-3 shadow-sm border border-slate-100 mb-3 flex justify-between items-center"><span class="text-xs font-bold text-slate-500">é¡¯ç¤ºç¯„åœ:</span><select v-model="mapFilter" @change="updateMapLayers" class="bg-slate-50 border border-slate-200 rounded px-2 py-1 text-xs outline-none font-bold text-slate-600"><option value="day">åƒ… Day {{ currentDay }}</option><option value="all">æ‰€æœ‰è¡Œç¨‹</option></select></div>
        <div id="map-full" class="bg-slate-200 shadow-inner"></div>
    </div>

    <!-- === TAB 4: HOTEL === -->
    <div v-show="currentTab === 'hotel'" class="px-6 flex-grow overflow-y-auto pt-4">
        <div class="mb-6">
            <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-slate-700 text-sm"><i class="fa-solid fa-bed text-indigo-400 mr-2"></i>ä½å®¿è³‡æ–™</h3><button v-if="!syncStatus.isGuest" @click="openInfoModal('hotel')" class="text-[10px] bg-indigo-50 text-indigo-500 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-100"><i class="fa-solid fa-plus"></i> æ–°å¢</button></div>
            <div v-if="infoData.hotels.length === 0" class="text-xs text-slate-400 text-center py-10 bg-slate-50 rounded-2xl border border-dashed border-slate-200"><i class="fa-solid fa-hotel text-2xl mb-2 opacity-50"></i><br>æš«ç„¡ä½å®¿è³‡æ–™</div>
            <div v-for="(h, idx) in infoData.hotels" :key="idx" class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100 mb-3 relative group hover:shadow-md transition">
                <button v-if="!syncStatus.isGuest" @click="removeInfo('hotels', idx)" class="absolute top-3 right-3 text-slate-200 hover:text-red-400 transition"><i class="fa-solid fa-xmark"></i></button>
                <div class="flex gap-3 mb-3"><div class="w-10 h-10 rounded-full bg-indigo-50 flex items-center justify-center text-indigo-500 flex-shrink-0"><i class="fa-solid fa-bed"></i></div><div class="font-bold text-slate-800 text-base leading-tight pt-1">{{ h.name }}</div></div>
                <div class="flex justify-between items-center"><div class="text-xs text-slate-500"><i class="fa-solid fa-calendar-check mr-1.5 text-indigo-300"></i> {{ h.dates }}</div><a v-if="h.link" :href="h.link" target="_blank" class="text-[10px] text-white bg-indigo-400 px-2 py-1 rounded hover:bg-indigo-500 transition font-bold"><i class="fa-solid fa-link"></i> è¨‚å–®</a></div>
            </div>
        </div>
    </div>

    <!-- === TAB 5: COST (V81 Redesigned) === -->
    <div v-show="currentTab === 'budget'" class="px-6 flex-grow overflow-y-auto pt-4 pb-24">
        <div class="bg-gradient-to-br from-[#0f4c75] to-[#3282b8] rounded-2xl p-4 text-white shadow-lg mb-6 relative overflow-hidden">
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-[9px] font-bold opacity-70 uppercase tracking-widest mb-1">ç¸½é ä¼°èŠ±è²»</div>
                    <div class="flex items-baseline gap-1"><span class="text-3xl font-bold font-mono tracking-tight">{{ formatMoney(totalTripCostHKD) }}</span><span class="text-sm font-bold opacity-60">HK$</span></div>
                </div>
                <div @click="!syncStatus.isGuest && (rateModal.open=true)" class="text-right cursor-pointer bg-white/10 px-3 py-2 rounded-xl hover:bg-white/20 transition"><div class="text-[10px] opacity-60">åŒ¯ç‡è¨­å®š <i v-if="!syncStatus.isGuest" class="fa-solid fa-pen ml-1"></i></div><div class="text-xs font-bold font-mono">1 ISK â‰ˆ {{ exchangeRate }}</div></div>
            </div>
        </div>
        <h3 class="font-bold text-slate-700 mb-3 text-sm px-1">åˆ†é¡æ¶ˆè²»çµ±è¨ˆ <span class="text-[10px] text-slate-400 font-normal ml-1">(ç´„ HK$)</span></h3>
        <div class="grid grid-cols-3 gap-2 mb-6 border-b border-dashed border-slate-200 pb-6">
            <div v-for="cat in categoryStats" :key="cat.key" class="bg-white p-3 rounded-xl border border-slate-100 shadow-sm flex flex-col items-center justify-center gap-1"><div class="w-8 h-8 rounded-full flex items-center justify-center text-xs mb-1" :class="cat.bg"><i class="fa-solid" :class="cat.icon"></i></div><div class="text-[10px] text-slate-400 font-bold">{{ cat.label }}</div><div class="text-xs font-bold font-mono text-slate-700">{{ formatMoney(Math.round(cat.amount)) }}</div></div>
            <div v-if="categoryStats.length === 0" class="col-span-3 text-center text-xs text-slate-400 py-4 bg-slate-50 rounded-xl">æš«ç„¡æ•¸æ“š</div>
        </div>
        <div class="flex justify-between items-end mb-4 px-1"><h3 class="font-bold text-slate-700 text-sm">æ¶ˆè²»æ˜ç´°</h3><span class="text-[10px] text-slate-400">{{ allExpenses.length }} ç­†è¨˜éŒ„</span></div>
        <div v-if="allExpenses.length === 0" class="text-center py-8 opacity-40"><div class="text-4xl mb-2 text-slate-300">ğŸ§¾</div><p class="text-xs text-slate-400">å°šç„¡æ¶ˆè²»è¨˜éŒ„</p></div>
        <div v-for="(exp, idx) in allExpenses" :key="idx" class="expense-item"><div class="w-10 h-10 rounded-full flex items-center justify-center mr-3 text-lg flex-shrink-0" :class="costTypes[exp.type]?.bg || 'bg-slate-100 text-slate-400'"><i class="fa-solid" :class="costTypes[exp.type]?.icon || 'fa-tag'"></i></div><div class="flex-grow min-w-0"><div class="text-xs font-bold text-slate-700 truncate">{{ exp.title }}</div><div class="text-[10px] text-slate-400 font-mono">Day {{ exp.day }} ({{ getDateString(exp.day).date }})</div></div><div class="text-right flex-shrink-0 mr-2"><div class="text-xs font-bold font-mono text-slate-800">{{ exp.currency }} {{ formatMoney(exp.amount) }}</div><div class="text-[9px] text-slate-400" v-if="exp.currency !== 'HK$'">â‰ˆ HK$ {{ formatMoney(Math.round(parseMoney(exp.amount) * exchangeRate)) }}</div></div><div v-if="exp.isManual && !syncStatus.isGuest" class="flex items-center gap-1 border-l pl-2 ml-1 border-slate-100"><button @click="openEditExpenseModal(exp)" class="text-slate-300 hover:text-blue-500 w-6 h-6 flex items-center justify-center"><i class="solid fa-pen text-xs"></i></button><button @click="deleteManualExpense(exp.day, exp.id)" class="text-slate-300 hover:text-red-400 w-6 h-6 flex items-center justify-center"><i class="fa-solid fa-trash-can text-xs"></i></button></div></div>
        <button v-if="!syncStatus.isGuest" @click="openExpenseModal" class="fixed bottom-24 right-6 bg-[#3282b8] text-white px-5 py-3 rounded-xl shadow-xl font-bold text-xs flex items-center gap-2 active:scale-95 transition z-30"><i class="fa-solid fa-plus"></i> è¨˜ä¸€ç­†</button>
    </div>

    <!-- === TAB 6: INFO (V85 NEW) === -->
    <div v-show="currentTab === 'info'" class="px-6 flex-grow overflow-y-auto pt-4 pb-24">
        <h3 class="font-bold text-slate-700 mb-4 text-sm"><i class="fa-solid fa-circle-info text-blue-400 mr-2"></i>å¯¦ç”¨è³‡è¨Š</h3>
        <div class="bg-red-50 rounded-2xl p-5 mb-6 border border-red-100 shadow-sm"><div class="flex justify-between items-start mb-2"><div><h4 class="text-red-600 font-black text-xl mb-1">112</h4><p class="text-xs text-red-400 font-bold">ç·Šæ€¥æ±‚æ•‘é›»è©± (è­¦å¯Ÿ/æ•‘è­·/æ¶ˆé˜²)</p></div><div class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-red-500 shadow-sm"><i class="fa-solid fa-phone"></i></div></div><p class="text-[10px] text-red-300 leading-relaxed">é‡åˆ°ä»»ä½•ç·Šæ€¥ç‹€æ³æˆ–è»Šè¼›å—å›°ï¼Œè«‹ç›´æ¥æ’¥æ‰“ 112ã€‚å»ºè­°ä¸‹è¼‰ <strong>112 Iceland</strong> App æ–¹ä¾¿å‚³é€å®šä½ã€‚</p></div>
        <div class="grid grid-cols-2 gap-3 mb-6"><a href="https://en.vedur.is/weather/forecasts/aurora/" target="_blank" class="bg-[#0B1D35] text-white p-4 rounded-2xl shadow-lg relative overflow-hidden group"><div class="absolute top-0 right-0 w-16 h-16 bg-green-400/20 rounded-full blur-xl -mr-4 -mt-4"></div><div class="relative z-10"><div class="text-2xl mb-2 text-green-300"><i class="fa-solid fa-star"></i></div><div class="font-bold text-sm">æ¥µå…‰é æ¸¬</div><div class="text-[9px] text-slate-400 mt-1">Vedur.is Aurora</div></div></a><a href="https://umferdin.is/en" target="_blank" class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 group"><div class="text-2xl mb-2 text-slate-700"><i class="fa-solid fa-road"></i></div><div class="font-bold text-sm text-slate-800">å³æ™‚è·¯æ³</div><div class="text-[9px] text-slate-400 mt-1">Road.is / Umferdin</div></a><a href="https://en.vedur.is/" target="_blank" class="bg-blue-50 p-4 rounded-2xl shadow-sm border border-blue-100 group"><div class="text-2xl mb-2 text-blue-500"><i class="fa-solid fa-cloud-sun"></i></div><div class="font-bold text-sm text-blue-800">å¤©æ°£é å ±</div><div class="text-[9px] text-blue-400 mt-1">Vedur.is Weather</div></a><a href="https://safetravel.is/" target="_blank" class="bg-orange-50 p-4 rounded-2xl shadow-sm border border-orange-100 group"><div class="text-2xl mb-2 text-orange-500"><i class="fa-solid fa-triangle-exclamation"></i></div><div class="font-bold text-sm text-orange-800">å®‰å…¨è­¦å ±</div><div class="text-[9px] text-orange-400 mt-1">SafeTravel.is</div></a></div>
        <div class="info-card"><h4 class="font-bold text-slate-700 text-xs mb-3 flex items-center gap-2"><i class="fa-solid fa-gauge-high text-green-500"></i> æ¥µå…‰æŒ‡æ•¸ (KP Index) åƒè€ƒ</h4><div class="space-y-2"><div class="flex items-center text-[10px] text-slate-500"><span class="kp-badge bg-slate-300">0-2</span> å¾®å¼±ï¼Œè‚‰çœ¼é›£è¦‹ï¼Œç›¸æ©Ÿå¯æ‹åˆ°</div><div class="flex items-center text-[10px] text-slate-600 font-bold"><span class="kp-badge bg-green-500">3</span> æ´»èºï¼Œè‚‰çœ¼å¯è¦‹ç¶ è‰²å…‰å¸¶</div><div class="flex items-center text-[10px] text-slate-600 font-bold"><span class="kp-badge bg-green-600">4</span> å¼·çƒˆï¼Œå…‰å¸¶èˆå‹•ï¼Œå¯èƒ½å‡ºç¾ç´«è‰²</div><div class="flex items-center text-[10px] text-slate-600 font-bold"><span class="kp-badge bg-yellow-500">5</span> é¢¨æš´ï¼Œå…¨å¤©ç©ºè¦†è“‹ï¼Œè‰²å½©è±å¯Œ</div><div class="flex items-center text-[10px] text-slate-600 font-bold"><span class="kp-badge bg-red-500">6+</span> å¼·çƒˆé¢¨æš´ï¼Œæ¥µå…¶ç½•è¦‹å£¯è§€</div></div></div>
         <div class="info-card"><h4 class="font-bold text-slate-700 text-xs mb-3 flex items-center gap-2"><i class="fa-solid fa-gas-pump text-red-400"></i> åŠ æ²¹å°è²¼å£«</h4><ul class="list-disc pl-4 text-[10px] text-slate-500 space-y-1.5"><li>ä¸»è¦æ²¹ç«™ï¼šN1, OlÃ­s, Orkan, OBã€‚</li><li><strong>å¿…å‚™ PIN Code</strong>ï¼šè‡ªåŠ©åŠ æ²¹éœ€ä½¿ç”¨ 4 ä½æ•¸ PIN ç¢¼ (ä¿¡ç”¨å¡é å€Ÿç¾é‡‘å¯†ç¢¼)ã€‚</li><li>å»ºè­°è³¼è²· N1 Prepaid Card ä»¥å‚™ä¸æ™‚ä¹‹éœ€ã€‚</li><li>é›¢é–‹åŸé®å‰è«‹ç¢ºä¿æ²¹ç®±æœ‰åŠæ¡¶ä»¥ä¸Šã€‚</li></ul></div>
    </div>

    <!-- BOTTOM NAVIGATION -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-100 pb-4 pt-2 px-1 flex justify-between z-50 h-[80px]">
        <button @click="switchTab('flight')" class="flex-1 flex flex-col items-center gap-1.5 transition-colors group" :class="currentTab === 'flight' ? 'tab-active' : 'tab-inactive'"><div class="text-xl"><i class="fa-solid fa-plane"></i></div><span class="text-[9px] font-bold tracking-wide">èˆªç­</span></button>
        <button @click="switchTab('itinerary')" class="flex-1 flex flex-col items-center gap-1.5 transition-colors group" :class="currentTab === 'itinerary' ? 'tab-active' : 'tab-inactive'"><div class="text-xl"><i class="fa-solid fa-list-ul"></i></div><span class="text-[9px] font-bold tracking-wide">è¡Œç¨‹</span></button>
        <button @click="switchTab('map')" class="flex-1 flex flex-col items-center gap-1.5 transition-colors group" :class="currentTab === 'map' ? 'tab-active' : 'tab-inactive'"><div class="text-xl"><i class="fa-solid fa-map"></i></div><span class="text-[9px] font-bold tracking-wide">åœ°åœ–</span></button>
        <button @click="switchTab('hotel')" class="flex-1 flex flex-col items-center gap-1.5 transition-colors group" :class="currentTab === 'hotel' ? 'tab-active' : 'tab-inactive'"><div class="text-xl"><i class="fa-solid fa-bed"></i></div><span class="text-[9px] font-bold tracking-wide">ä½å®¿</span></button>
        <button @click="switchTab('budget')" class="flex-1 flex flex-col items-center gap-1.5 transition-colors group" :class="currentTab === 'budget' ? 'tab-active' : 'tab-inactive'"><div class="text-xl"><i class="fa-solid fa-wallet"></i></div><span class="text-[9px] font-bold tracking-wide">èŠ±è²»</span></button>
        <button @click="switchTab('info')" class="flex-1 flex flex-col items-center gap-1.5 transition-colors group" :class="currentTab === 'info' ? 'tab-active' : 'tab-inactive'"><div class="text-xl"><i class="fa-solid fa-circle-info"></i></div><span class="text-[9px] font-bold tracking-wide">è³‡è¨Š</span></button>
    </div>

    <!-- MODAL: ADD INFO -->
    <div v-if="infoModal.open" class="fixed inset-0 z-[100] flex items-center justify-center p-6"><div class="absolute inset-0 modal-overlay" @click="infoModal.open=false"></div><div class="relative bg-white w-full max-w-sm rounded-[2rem] p-8 shadow-2xl space-y-4 animate-slide-up"><h3 class="font-bold text-xl text-slate-800">æ–°å¢ä½å®¿</h3><input v-model="infoForm.name" class="modal-input" placeholder="ä½å®¿åç¨±"><input v-model="infoForm.dates" class="modal-input" placeholder="å…¥ä½æ—¥æœŸ"><input v-model="infoForm.link" class="modal-input" placeholder="è¨‚å–®é€£çµ (é¸å¡«)"><div class="flex gap-3 mt-4"><button @click="infoModal.open=false" class="flex-1 py-3 bg-slate-100 rounded-xl font-bold text-slate-500">å–æ¶ˆ</button><button @click="saveInfo" class="flex-1 py-3 bg-[#3282b8] text-white rounded-xl font-bold shadow-lg shadow-blue-500/20">æ–°å¢</button></div></div></div>
    <!-- MODAL: RATE -->
    <div v-if="rateModal.open" class="fixed inset-0 z-[100] flex items-center justify-center p-6"><div class="absolute inset-0 modal-overlay" @click="rateModal.open=false"></div><div class="relative bg-white w-full max-w-sm rounded-[2rem] p-8 text-center shadow-2xl animate-slide-up"><h3 class="font-bold text-xl text-slate-800 mb-6">è¨­å®šåŒ¯ç‡</h3><div class="relative mb-8"><input type="number" v-model="exchangeRate" class="text-4xl text-center border-b-2 border-slate-100 w-full pb-2 font-mono text-slate-700 focus:outline-none focus:border-blue-400" step="0.001"><div class="text-xs text-slate-400 mt-2">1 ISK = HKD</div></div><button @click="rateModal.open=false" class="w-full py-3.5 bg-[#3282b8] text-white rounded-xl font-bold shadow-lg shadow-blue-500/20">ç¢ºèªè¨­å®š</button></div></div>
    
    <!-- MODAL: SYNC (V92 NEW) -->
    <div v-if="syncModal.open" class="fixed inset-0 z-[100] flex items-center justify-center p-6">
        <div class="absolute inset-0 modal-overlay" @click="syncModal.open=false"></div>
        <div class="relative bg-white w-full max-w-sm rounded-[2rem] p-8 text-center space-y-4 animate-slide-up max-h-[85vh] overflow-y-auto">
            <div class="w-16 h-16 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto text-2xl mb-2"><i class="fa-solid fa-cloud-arrow-up"></i></div>
            <h3 class="font-bold text-xl text-slate-800">GitHub é›²ç«¯åŒæ­¥</h3>
            
            <div v-if="syncStatus.isGuest">
                 <div class="bg-orange-50 p-4 rounded-xl border border-orange-100 mb-4">
                     <p class="text-xs text-orange-600 font-bold mb-2">æ‚¨ç›®å‰æ˜¯ã€Œè¨ªå®¢æ¨¡å¼ã€</p>
                     <p class="text-[10px] text-slate-500">æ‚¨å¯ä»¥æª¢è¦–æ‰€æœ‰è¡Œç¨‹å’Œæœ€æ–°èŠ±è²»ï¼Œä½†ç„¡æ³•ä¿®æ”¹ã€‚</p>
                 </div>
                 <button @click="pullFromCloud" class="w-full py-3 bg-[#3282b8] text-white rounded-xl font-bold shadow-lg active:scale-95 transition text-xs mb-2">
                    <i class="fa-solid fa-rotate mr-2"></i> é‡æ–°æ•´ç† (ä¸‹è¼‰æœ€æ–°è³‡æ–™)
                 </button>
                 <button @click="resetSync" class="w-full py-3 bg-slate-100 text-slate-500 rounded-xl font-bold active:scale-95 transition text-xs">
                    <i class="fa-solid fa-right-from-bracket mr-2"></i> ç™»å‡º/åˆ‡æ› ID
                 </button>
            </div>
            
            <div v-else>
                <!-- Config Section -->
                <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-4 text-left">
                     <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">åŒæ­¥è¨­å®š</div>
                     <input v-model="gistConfig.id" class="modal-input text-xs mb-2" placeholder="è²¼ä¸Š Gist ID (å¿…å¡«)">
                     <input v-model="gistConfig.token" class="modal-input text-xs" type="password" placeholder="GitHub Token (è¨ªå®¢å…å¡«)">
                     <div class="text-[9px] text-slate-400 mt-2 leading-relaxed">
                        <span class="text-blue-500 font-bold">ä¸»æªè«‹å¡« Token</span> ä»¥ä¾¿ä¸Šå‚³ä¿®æ”¹ã€‚<br>
                        <span class="text-orange-500 font-bold">éšŠå‹/è¨ªå®¢</span> åªéœ€å¡« ID å³å¯ä¸‹è¼‰ã€‚
                     </div>
                </div>

                <div class="flex gap-2 mb-2">
                     <button @click="pullFromCloud" class="flex-1 py-3 bg-white border border-slate-200 text-slate-600 rounded-xl font-bold active:scale-95 transition text-xs">
                        <i class="fa-solid fa-cloud-arrow-down mr-2"></i> ä¸‹è¼‰é›²ç«¯
                     </button>
                     <button @click="pushToCloud" class="flex-1 py-3 bg-[#3282b8] text-white rounded-xl font-bold shadow-lg shadow-blue-500/20 active:scale-95 transition text-xs">
                        <i class="fa-solid fa-cloud-arrow-up mr-2"></i> ä¸Šå‚³åŒæ­¥
                     </button>
                </div>
                
                <!-- Share ID Generator -->
                <div v-if="gistConfig.id" class="mt-6 border-t pt-4">
                     <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2">çµ¦æœ‹å‹çš„ ID</div>
                     <div class="bg-slate-100 p-2 rounded-lg text-xs font-mono text-slate-600 break-all mb-2 select-all">{{ gistConfig.id }}</div>
                     <button @click="copyID" class="w-full py-3 bg-green-500 text-white rounded-xl font-bold shadow-lg shadow-green-500/20 active:scale-95 transition text-xs">
                        <i class="fa-regular fa-copy mr-2"></i> è¤‡è£½ ID å‚³çµ¦æœ‹å‹
                     </button>
                </div>
            </div>

            <button @click="syncModal.open=false" class="w-full py-3 bg-slate-100 rounded-xl font-bold text-slate-500 mt-2">é—œé–‰</button>
        </div>
    </div>
    
    <!-- MODAL: WELCOME (V92 NEW) -->
    <div v-if="welcomeModal.open" class="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-[#0f4c75]">
        <div class="relative bg-white w-full max-w-sm rounded-[2rem] p-8 text-center space-y-6 shadow-2xl animate-slide-up">
            <div class="w-20 h-20 bg-blue-50 text-[#3282b8] rounded-full flex items-center justify-center mx-auto text-3xl mb-2 animate-bounce"><i class="fa-solid fa-plane-departure"></i></div>
            <h1 class="font-extrabold text-2xl text-slate-800">æ­¡è¿ä½¿ç”¨ Iceland Trip</h1>
            <p class="text-xs text-slate-400 leading-relaxed px-2">é€™æ˜¯ä¸€å€‹é›¢ç·šæ—…éŠæ‰‹å†Šã€‚è«‹å•æ‚¨æ˜¯è² è²¬è¦åŠƒçš„ä¸»æªï¼Œé‚„æ˜¯å—é‚€çš„éšŠå‹ï¼Ÿ</p>
            
            <div class="space-y-3">
                 <button @click="welcomeModal.open=false" class="w-full py-4 bg-slate-50 text-slate-600 rounded-2xl font-bold border border-slate-100 active:scale-95 transition flex items-center justify-center gap-3">
                    <span class="w-8 h-8 rounded-full bg-slate-200 flex items-center justify-center text-xs"><i class="fa-solid fa-pen"></i></span>
                    <div class="text-left"><div class="text-xs text-slate-800">æˆ‘æ˜¯ä¸»æª</div><div class="text-[9px] text-slate-400">å»ºç«‹æ–°è¡Œç¨‹æˆ–ç·¨è¼¯</div></div>
                 </button>
                 <button @click="openGuestSetup" class="w-full py-4 bg-[#3282b8] text-white rounded-2xl font-bold shadow-xl shadow-blue-500/20 active:scale-95 transition flex items-center justify-center gap-3">
                    <span class="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center text-xs"><i class="fa-solid fa-user-group"></i></span>
                    <div class="text-left"><div class="text-xs text-white">æˆ‘æ˜¯éšŠå‹</div><div class="text-[9px] text-blue-200">è¼¸å…¥ ID åŒæ­¥è¡Œç¨‹</div></div>
                 </button>
            </div>
        </div>
    </div>

    <!-- MODAL: MANUAL EXPENSE (V82 Updated) -->
    <div v-if="expenseModal.open" class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="absolute inset-0 modal-overlay" @click="expenseModal.open=false"></div>
        <div class="relative bg-white w-full max-w-sm rounded-t-[2rem] sm:rounded-[2rem] p-6 pb-10 shadow-2xl animate-slide-up">
            <h3 class="font-bold text-xl text-slate-800 mb-6">{{ expenseModal.mode==='edit'?'ç·¨è¼¯':'è¨˜ä¸€ç­†' }}æ¶ˆè²»</h3>
            <div class="space-y-4">
                <div><label class="text-xs font-bold text-slate-400 mb-1.5 block">æ—¥æœŸ</label><select v-model="expenseForm.day" class="modal-input"><option v-for="d in totalDays" :value="d">Day {{d}} ({{ getDateString(d).date }})</option></select></div>
                <div><label class="text-xs font-bold text-slate-400 mb-1.5 block">æ¶ˆè²»é …ç›®</label><input v-model="expenseForm.title" class="modal-input" placeholder="ä¾‹å¦‚: N1 å…¥æ²¹"></div>
                <div class="flex gap-3">
                    <div class="w-1/2"><label class="text-xs font-bold text-slate-400 mb-1.5 block">ç¨®é¡</label><select v-model="expenseForm.type" class="modal-input"><option v-for="(v,k) in costTypes" :value="k">{{v.label}}</option></select></div>
                    <div class="w-1/2"><label class="text-xs font-bold text-slate-400 mb-1.5 block">å¹£åˆ¥</label><div class="flex bg-slate-50 rounded-xl p-1 border border-slate-200"><button @click="expenseForm.currency='ISK'" class="flex-1 py-2 rounded-lg text-xs font-bold transition" :class="expenseForm.currency==='ISK'?'bg-white shadow text-[#3282b8]':'text-slate-400'">ISK</button><button @click="expenseForm.currency='HK$'" class="flex-1 py-2 rounded-lg text-xs font-bold transition" :class="expenseForm.currency==='HK$'?'bg-white shadow text-red-500':'text-slate-400'">HK$</button></div></div>
                </div>
                <div><label class="text-xs font-bold text-slate-400 mb-1.5 block">é‡‘é¡</label><input v-model="expenseForm.amount" type="number" class="modal-input font-mono text-xl" placeholder="0"></div>
                <button @click="saveManualExpense" class="w-full py-4 bg-[#3282b8] text-white rounded-2xl font-bold shadow-lg shadow-blue-500/20 mt-4 active:scale-95 transition">å„²å­˜è¨˜éŒ„</button>
            </div>
        </div>
    </div>

    <!-- MODAL: ADD/EDIT ACTIVITY -->
    <div v-if="modal.open" class="fixed inset-0 z-[100] flex items-end sm:items-center justify-center p-0 sm:p-4"><div class="absolute inset-0 modal-overlay transition-opacity" @click="modal.open=false"></div><div class="relative bg-white w-full max-w-sm rounded-t-[2rem] sm:rounded-[2rem] p-6 pb-10 shadow-2xl animate-slide-up max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center mb-6"><h3 class="font-extrabold text-xl text-slate-800">{{ modal.mode==='add'?'æ–°å¢':'ç·¨è¼¯' }}è¡Œç¨‹</h3><button @click="modal.open=false" class="w-8 h-8 bg-slate-50 rounded-full text-slate-400 hover:bg-slate-100"><i class="fa-solid fa-xmark"></i></button></div><div class="space-y-5"><div class="flex gap-4"><div class="w-1/2"><label class="text-xs font-bold text-slate-400 mb-1.5 block">æ™‚é–“</label><input type="time" v-model="form.time" class="modal-input"></div><div class="w-1/2"><label class="text-xs font-bold text-slate-400 mb-1.5 block">æŠµé”(é¸å¡«)</label><input type="time" v-model="form.endTime" class="modal-input"></div></div><div class="flex gap-4"><div class="w-1/2"><label class="text-xs font-bold text-slate-400 mb-1.5 block">ç¨®é¡</label><select v-model="form.type" class="modal-input"><option v-for="(v,k) in categoryConfig" :value="k">{{v.emoji}} {{v.label}}</option></select></div><div class="w-1/2"><label class="text-xs font-bold text-slate-400 mb-1.5 block">è·é›¢</label><input v-model="form.distance" class="modal-input"></div></div><div><label class="text-xs font-bold text-[#3282b8] mb-1.5 block">1. åœ–ç‰‡ç¶²å€</label><input v-model="form.imgUrl" class="modal-input text-xs" placeholder="ç•™ç©ºå°‡ç”± AI è‡ªå‹•ç”¢ç”Ÿ"></div><div><label class="text-xs font-bold text-[#3282b8] mb-1.5 block">2. æ¨™é¡Œ</label><input v-model="form.title" class="modal-input text-lg placeholder:text-slate-300" placeholder="ä¾‹å¦‚: SkÃ³gafoss"></div><div class="bg-slate-50 p-4 rounded-2xl border border-slate-100 space-y-2"><label class="text-xs font-bold text-[#3282b8] block">3. åœ°é» & å®šä½</label><div class="flex gap-2"><input v-model="form.location" class="modal-input bg-white" placeholder="è¼¸å…¥åœ°é»åç¨±æœå°‹"><button @click="autoLocate" class="w-12 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center transition active:scale-95"><i class="fa-solid" :class="locating?'fa-spinner fa-spin':'fa-map-location-dot'"></i></button></div><div class="flex gap-2 text-[10px] items-center"><input type="number" v-model.number="form.lat" class="border p-1.5 rounded-lg w-20 text-center" placeholder="Lat"><input type="number" v-model.number="form.lng" class="border p-1.5 rounded-lg w-20 text-center" placeholder="Lng"><span v-if="form.lat" class="text-green-600 font-bold ml-auto flex items-center gap-1"><i class="fa-solid fa-check-circle"></i> å·²å®šä½</span></div><input v-model="form.mapUrl" class="modal-input
